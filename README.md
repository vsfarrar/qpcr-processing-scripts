# qPCR Processing R Scripts
Author: Victoria Farrar

Last Updated: 2/2/2022

These R scripts take raw Cq data from qPCR runs, clean and average the triplicate data, and then perform the ddCt method as per Livak and Schmittgen (2001). 

## Scripts 
Two scripts are included here and are required: 

1. `qPCR_general_processing_script.R` - script to be edited, runs all steps of analysis pipeline
	* 	highly recommend making a copy of this for each project, saving and renaming for each project for your records. 
2. `qPCR_processing_functions.R` -  includes functions for cleaning and averaging triplicates. Do NOT edit this file! 

## Preparing Required Data 
Requires two .csv datasets to run: 

1. **Raw Cq data** -MUST include the following variables: 
	* **gene** - abbreviation for gene measured
	* **sample** - some kind of unique sample id (e.g. band number)
	* **cq** - cycle threshold for that well, calculated by the BioRad software
	* **tissue** - tissue or organ type (abbreviation is fine) 

The cq data can be downloaded from the BioRad machine software, and use the platelayout_converter.xlsx document on the Calisi lab desktop to add sample and gene information to the file. 

*Note*: Remove H2O wells and empty wells before importing this data to R. This will cause issues in the code if they are included. 

ex: 

<!-- example-table-LIST:START -->
| gene| sample | tissue | cq |
| :----| :---- | :---- | :---- |
| PRL | 865|pituitary| 34.5 |
| PRL | 462|pituitary| 21.3 | 
| ACTB | 865|testes| 18.2 | 
| ACTB | N1954.chickA|testes| 18.3|

2. **Key with Sample and Treatment/Control Groups**: 
a key that includes all the samples in your raw data (entered in the same format) along with what treatment group they are in. This is most important for the control group you are interested in using as your reference for relative expression in the ddCt method (e.g., vehicle females). 
	* 
MUST have the following variables: 
	* **sample** : must match the samples in the raw data file
	* **treatment** : groups to be compared for relative expression (e.g. vehicle vs treatment, paired versus single). 
		* Can also be combinations of variables if that is what is of interest (e.g. vehicle females, vehicle males, treatment females, treatment males, or young inexperienced, old inexperienced, etc.) 
		* Make sure levels of treatment are entered consistently, otherwise errors will arise! 

ex: 

<!-- example-table-LIST:START -->
| sample| treatment | 
| :----| :---- |
| 865 | vehicle_adult|
| 462 | vehicle_adult|
| N1954.chickA| treated_chick|

*Note:* Any extra columns in this sample key will be dropped in analysis, and will need to be rejoined later. 

## How To Run Code

1.In the "EDIT HERE" section of the code, **set your working directory**. This should be a folder where your two data .csv files (see above), a copy of these two R scripts are stored, and where the output file will be written to. 

e.g. `setwd("~/Documents/qPCR_processing/")`

2.Enter the name of your **raw qPCR data file** as `raw_data`. (See #1 above)

e.g. `raw_data <- read.csv("hipp_qPCR_raw_data.csv")`

3.Enter the name of your **key data file** as `key`. (See #2 above) 

e.g. `key <- read.csv("hipp_sample_key.csv")`

4.Define your **control group** (the reference group for relative expression). NOTE: This needs to be entered *exactly* how it is entered in your sample key! 

e.g. `control_group <- "vehicle_adult"`

5.Enter your **project name.** (This is used for naming the output file, so whatever project name or sample description you'd want in the file name. You can always rename later!) 

e.g. `project_name <- "PRL-pump-project"`

6.[OPTIONAL] Define **specific reference genes you want to normalize to**. This is especially if you have reference genes in your dataset that you do NOT want to normalize to (i.e., ones that vary significantly with treatment). If you don't enter anything here, the script will normalize expression to any gene name that matches common reference genes used in the Calisi lab. NOTE: The names listed here must *exactly match* how they are entered in your raw cq data! 

e.g. `custom_refgenes <- c("hprt1", "rpl4")`

7.Once all this is entered, **RUN the whole script**! Everything should run automatically, and a results .csv should be output into the folder defined in step 1. This output can be used for statistical analysis. 

* The dataframe `dat_qpcr_final` will also be the final dataframe if you want to begin statistical analysis in the same R session. 

## Useful Resources

* Original paper on ddCt method [Livak and Schmittgen (2001) *Methods*](https://www.sciencedirect.com/science/article/pii/S1046202301912629?via%3Dihub).
* Useful blogpost on the ddCt method: [4 Easy Steps to Analyze Your qPCR Data Using Double Delta Ct Analysis | BiteSizeBio](https://bitesizebio.com/24894/4-easy-steps-to-analyze-your-qpcr-data-using-double-delta-ct-analysis/)